# ICE Tracker — Full repo review

Review of root and all variants (v2–v5), config, docs, and tooling. Date: 2026-02-12.

---

## 1. Root (main app)

### 1.1 Config & env

| File | Status | Notes |
|------|--------|--------|
| **.env.example** | OK | Documents `NEXT_PUBLIC_SITE_URL`, `NEXT_PUBLIC_GA_ID`. No secrets. |
| **.gitignore** | Gaps | Ignores `.next/`, `node_modules/`, `.env*`, `next-env.d.ts`, `*.tsbuildinfo`, `DS_Store`, etc. **Missing:** `prompts.db`, `*.db` (v2/v3/v4 already ignore these in their own .gitignore). **Missing:** `.qodo/` if you use Qodo; safe to add. |
| **package.json** | OK | 0.1.0, Next 14.2.18, React 18, leaflet, react-leaflet, rss-parser. Scripts: dev, build, start, lint. |
| **package-lock.json** | OK | lockfileVersion 3, consistent with package.json. |
| **tsconfig.json** | OK | `paths: { "@/*": ["./*"] }`, include next-env.d.ts + **/*.ts(x), exclude node_modules. |
| **next.config.js** | Minimal | Empty `nextConfig = {}`. No security headers, no rewrites; v2+ add headers in their own next.config. |
| **next-env.d.ts** | OK | Generated by Next; correctly in .gitignore so usually not in repo. |

### 1.2 App structure (root)

- **app/layout.tsx, page.tsx, globals.css** — Present; page uses client components, dynamic MapView, feed from `/api/ice-news`.
- **app/api/ice-news/route.ts** — RSS aggregation; returns JSON.
- **app/lib/** — analytics, community-reports, seo (no shared `types` in root; types inferred from API route).
- **app/components/** — MapView, GoogleAnalytics, WebVitals, StructuredNewsLd.
- **app/sitemap.ts, robots.ts** — Present.
- **data/** — ero-offices.json, state-coords.json (no know-your-rights or hotlines in root; those are in v3+).
- **public/manifest.json** — Present.

Root app is the original 0.1.0: map, feed, filters, community reports (localStorage), FAQ, no Know Your Rights/hotlines, no AI.

### 1.3 Docs & meta (root)

| File | Status | Notes |
|------|--------|--------|
| **README.md** | OK | Run, build, push, Git AI, metadata note; links to docs. |
| **CHANGELOG.md** | OK | Keep a Changelog style; 0.1.0 and Unreleased; detailed. |
| **xeo.md** | OK | SEO/GEO/XEO/Ahrefs/GSC how-to (moved out of README). |
| **git-ai-xeo-links.md** | OK | Git AI install, prompt-analysis, xEo repo links. |
| **docs/** | OK | GIT_AI_RUN_ON_ICE_TRACKER, GIT_AI_RESEARCH, DOCS_INDEX, INTERNET_RESEARCH, ENV_AND_PUBLIC_API, DEPLOY_AND_MONETIZE, GIT_AI_LOCATIONS_BY_DEPTH, SIMILAR_TO_GIT_AI, WHAT_ELSE_CAN_BE_ADDED. |

### 1.4 CI & scripts

| Item | Status | Notes |
|------|--------|--------|
| **.github/workflows/ci.yml** | OK | On push/PR to master|main; Node 20, npm ci, npm run build. |
| **.github/workflows/git-ai.yaml** | OK | On PR closed + merged; installs git-ai, runs `git-ai ci github run` to fix squash-merge notes. |
| **scripts/push-avatararts.sh** | OK | Sources ~/.env.d/github.env, pushes to AvaTar-ArTs/ice-tracker. |
| **scripts/git-ai-stats-release.sh** | OK | Optional; git-ai stats for range (default full history), ignores lockfiles. |

### 1.5 Prompts.db & .qodo

- **prompts.db** — Not in root .gitignore. v2, v3, v4 each have `prompts.db` in their own .gitignore. If any tool (e.g. Cursor or another agent) writes `prompts.db` in the repo root, it could be committed. **Recommendation:** Add `prompts.db` and `*.db` to root `.gitignore`.
- **.qodo** — You @-mentioned it; not present in repo and not in .gitignore. If you use Qodo, add `.qodo/` to root `.gitignore`.

---

## 2. Variants (v2, v3, v4, v5)

| Variant | Stack | Purpose |
|---------|--------|--------|
| **v2** | Next 14, React 18 | URL state, API cache, security headers, shared types/constants, a11y, error/retry. |
| **v3** | Next 14, React 18 | v2 + Know Your Rights, hotlines (in-app), server AI (OpenAI/Gemini) behind `NEXT_PUBLIC_AI_ENABLED`. |
| **v4** | Next 14, React 18 | v3 feature set with in-browser AI (Transformers.js); no server AI or API keys. |
| **v5** | Express, vanilla HTML/CSS/JS | Same features as v4; no React; static + `/api/ice-news`; AI via esm.sh dynamic import. |

- Each has its own **package.json**, **.gitignore**, and (where applicable) **next.config.js**, **tsconfig.json**. v5 has **server.js** and **public/**.
- **prompts.db** is in v2, v3, v4 .gitignore; v5 has no prompts.db mention (Node server only).
- Versioning: root 0.1.0, v2 0.2.0, v3/v4/v5 in their package.json (e.g. 0.4.0, 0.5.0).

---

## 3. Consistency & hygiene

- **Branch:** CI and push script target **master**; ensure default branch name matches (master vs main).
- **Env:** Root .env.example is minimal; v3/v4 have richer .env.example (e.g. AI, cache TTL). Root is fine for the base app.
- **Duplicate content:** Some doc text is shared (e.g. Git AI install) across README, GIT_AI_RUN_ON_ICE_TRACKER, git-ai-xeo-links; acceptable for discoverability.
- **next-env.d.ts:** Generated; ignored in root and in v2/v3/v4; no action needed.

---

## 4. Recommendations (actionable)

1. **Root .gitignore** — Add:
   - `prompts.db` and `*.db`
   - `.qodo/` (if you use Qodo)
2. **Root next.config.js** — Optional: add security headers (X-Frame-Options, X-Content-Type-Options, etc.) to align with v2+ if you deploy root.
3. **CHANGELOG [Unreleased]** — Consider adding v2/v3/v4/v5 and recent doc/SEO/xeo changes if you want them recorded before next release.
4. **Default branch** — Confirm GitHub default branch (master vs main) matches `ci.yml` and `push-avatararts.sh` (both use `master`).

---

## 5. Quick reference

| What | Where |
|------|--------|
| Run main app | `npm install && npm run dev` (root) |
| Run v2/v3/v4 | `cd v2|v3|v4 && npm install && npm run dev` |
| Run v5 | `cd v5 && npm install && npm start` |
| Push | `./scripts/push-avatararts.sh` |
| Git AI status | `git-ai status`; blame: `git-ai blame <file>` |
| Env template | Root `.env.example`; v3/v4 have their own. |
| SEO/how-to | `xeo.md` |
| Git AI + xEo links | `git-ai-xeo-links.md` |
| What to run (Git AI) | `docs/GIT_AI_RUN_ON_ICE_TRACKER.md` |
