<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0c0e12" />
  <title>ICE Activity Tracker | Live ICE Enforcement & ERO News</title>
  <meta name="description" content="Track U.S. ICE activity: live news, ERO map, Know Your Rights, hotlines, in-browser AI summaries, community reports." />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div id="app" class="app">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header class="header">
      <div class="header-left">
        <h1 class="title">ICE Activity Tracker</h1>
        <span class="tagline">U.S. ICE · News, map, Know Your Rights, hotlines, in-browser AI</span>
      </div>
      <div class="header-controls">
        <select id="refresh-interval" aria-label="Auto-refresh interval">
          <option value="60000">1 min</option>
          <option value="300000" selected>5 min</option>
          <option value="900000">15 min</option>
        </select>
        <span id="updated-label" class="updated-label"></span>
        <button type="button" id="btn-new" class="btn-new" hidden>0 new</button>
        <button type="button" id="btn-refresh" class="btn-refresh">Refresh</button>
      </div>
    </header>

    <div class="main-row">
      <aside class="sidebar">
        <div class="sidebar-inner">
          <div id="fetch-error" class="fetch-error" hidden></div>
          <div class="filters">
            <select id="filter-state" aria-label="Filter by state">
              <option value="">All states</option>
            </select>
            <select id="filter-source" aria-label="Filter by source">
              <option value="all">All sources</option>
              <option value="enforcement">Enforcement & Removal</option>
              <option value="breaking">Breaking news</option>
              <option value="state">State feeds</option>
            </select>
            <button type="button" id="btn-report" class="btn-report">+ Report</button>
          </div>
          <div class="links-row">
            <button type="button" id="btn-kyr" class="link-btn">Know Your Rights</button>
            <button type="button" id="btn-hotlines" class="link-btn">Rapid response & hotlines</button>
          </div>
          <div id="panel-kyr" class="panel" hidden></div>
          <div id="panel-hotlines" class="panel" hidden></div>
          <form id="form-report" class="report-form" hidden>
            <p class="form-note">Add a community report (saved in this browser only). Unverified.</p>
            <p class="form-warn">If someone needs help now, open <strong>Rapid response & hotlines</strong> for hotline numbers.</p>
            <input type="text" id="report-state" placeholder="State (e.g. CA)" maxlength="2" aria-label="State" />
            <input type="text" id="report-city" placeholder="City (optional)" aria-label="City" />
            <textarea id="report-desc" placeholder="Description (optional)" rows="2" aria-label="Description"></textarea>
            <div class="form-actions">
              <button type="submit" class="btn-primary">Save</button>
              <button type="button" id="btn-cancel-report" class="btn-secondary">Cancel</button>
            </div>
          </form>
          <div class="meta-row">
            <span id="feed-count" class="feed-count">0 items</span>
            <button type="button" id="btn-clear-reports" class="link-btn warn" hidden>Clear my reports (0)</button>
          </div>
          <button type="button" id="btn-faq" class="link-btn">FAQ</button>
          <button type="button" id="btn-live-tips" class="link-btn">Ways to get live updates</button>
          <div id="panel-faq" class="panel" hidden></div>
          <div id="panel-live-tips" class="panel" hidden></div>

          <div class="ai-block">
            <button type="button" id="btn-ai" class="link-btn ai-btn">Summarize with AI (in-browser)</button>
            <p class="ai-hint">Runs in your browser; first time may load a model.</p>
            <p id="ai-error" class="ai-error" hidden></p>
            <div id="ai-result" class="ai-result" hidden><span class="ai-badge">In-browser</span> <span id="ai-summary"></span></div>
          </div>

          <div id="main-content" class="feed-container" role="feed" aria-label="Latest ICE enforcement and ERO news" tabindex="-1">
            <h2 class="feed-heading">Latest ICE activity & enforcement news</h2>
            <div id="feed-loading" class="feed-loading">Loading ICE news…</div>
            <ul id="feed-list" class="feed-list" hidden></ul>
            <div id="feed-empty" class="feed-empty" hidden>No items match filters.</div>
          </div>
        </div>
      </aside>
      <main class="map-wrap" aria-label="Map of ERO offices and ICE news">
        <div id="map" class="map"></div>
      </main>
    </div>

    <footer class="footer">
      <span>Data: ICE.gov RSS. Know Your Rights & hotlines in-app. AI in-browser (no API keys). Not legal advice.</span>
      <a href="https://www.ice.gov/newsroom" target="_blank" rel="noopener noreferrer">ICE Newsroom</a>
      <a href="https://www.ice.gov/contact/field-offices" target="_blank" rel="noopener noreferrer">ERO field offices</a>
    </footer>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="/js/map.js"></script>
  <script type="module" src="/js/app.js"></script>
</body>
</html>
